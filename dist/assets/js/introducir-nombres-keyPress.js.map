{"version":3,"names":[],"mappings":"","sources":["introducir-nombres-keyPress.js"],"sourcesContent":["(window => {\n  const XHR = new XMLHttpRequest();\n  const formElem = document.getElementById(\"namesForm\");\n  const inputElems = document.querySelectorAll(\"input[type=text]\");\n  const errorElems = document.querySelectorAll(\"p.error\");\n  let movistar_list = window[\"movistar\"].movistar_list;\n  let isInResponse = window[\"movistar\"][\"helpers\"].isInResponse;\n  let invariables = window[\"movistar\"][\"helpers\"].invariables;\n  let errorMessages = window[\"movistar\"].errorMessages;\n\n  let findErrorElem = finder => {\n    let found;\n    errorElems.forEach(err => {\n      if (err.id === finder) {\n        found = err;\n      }\n    });\n    return found;\n  };\n\n  let getWordsToFind = stringArray => {\n    let result = {\n      toCheck: [],\n      invars: []\n    };\n\n    stringArray.forEach(s => {\n      if (invariables.indexOf(s) >= 0) {\n        result.invars.push(s);\n      } else {\n        result.toCheck.push(s);\n      }\n    });\n\n    return result;\n  };\n\n  let checkCharacterOnKeypress = e => {\n    let regex = new RegExp(\"^[a-zA-ZÀ-ÿ\\u00f1\\u00d1 ]+$\");\n    let key = String.fromCharCode(!e.charCode ? e.which : e.charCode);\n    if (!regex.test(key)) {\n      event.preventDefault();\n      return false;\n    }\n  };\n\n  let checkWordsOnBlur = e => {\n    let inpuId = e.currentTarget.id;\n    let errorEl = findErrorElem(inpuId + \"error\");\n\n    if (e.currentTarget.value === \"\") {\n      e.currentTarget.value = \"Introduzca un nombre\";\n    }\n\n    if (\n      e.currentTarget.value != \"\" &&\n      e.currentTarget.value != \"Introduzca un nombre\"\n    ) {\n      // remove white spaces\n      let originalValue = e.currentTarget.value.replace(/\\s\\s+/g, \" \").trim();\n      // split words\n      let wordsToCheck = originalValue.split(\" \");\n      // object with words to find on xhr response\n      let selectedWordsToFind = getWordsToFind(wordsToCheck);\n      // name to check (string: \"iñigo carmen\")\n      let name =\n        selectedWordsToFind.toCheck.length === 2\n          ? selectedWordsToFind.toCheck[0] +\n            \" \" +\n            selectedWordsToFind.toCheck[1]\n          : selectedWordsToFind.toCheck[0];\n      //let result = [];\n\n      // if name is more than two words, log error.\n      if (selectedWordsToFind.toCheck.length > 2) {\n        errorEl.innerHTML = errorMessages.larges;\n        e.currentTarget.setAttribute(\"data-test\", \"error\");\n        return;\n      } else {\n        errorEl.innerHTML = \"\";\n      }\n      // if is on the database says ok if not says error\n      if (isInResponse(name, JSON.parse(XHR.responseText))) {\n        //result.push(name);\n        e.currentTarget.setAttribute(\"data-test\", \"ok\");\n        return;\n      } else {\n        //e.currentTarget.value = \"\";\n        e.currentTarget.setAttribute(\"data-test\", \"error\");\n        errorEl.innerHTML = errorMessages.notFound;\n      }\n    }\n    if (e.currentTarget.value === \"\") {\n      e.currentTarget.setAttribute(\"data-test\", \"empty\");\n    }\n\n    return;\n  };\n  let resetErrorOnFocus = e => {\n    if (e.currentTarget.value === \"Introduzca un nombre\") {\n      e.currentTarget.value = \"\";\n    }\n    let inpuId = e.currentTarget.id;\n    let errorEl = findErrorElem(inpuId + \"error\");\n    errorEl.innerHTML = \"\";\n  };\n\n  let addEventsToInputs = () => {\n    inputElems.forEach(input => {\n      input.addEventListener(\"keypress\", checkCharacterOnKeypress, false);\n      input.addEventListener(\"blur\", checkWordsOnBlur, false);\n      input.addEventListener(\"focus\", resetErrorOnFocus, false);\n    });\n  };\n\n  let showForm = () => {\n    if (formElem.classList.contains(\"hidden\")) {\n      formElem.classList.remove(\"hidden\");\n    }\n  };\n\n  XHR.open(\"GET\", movistar_list);\n  XHR.send();\n\n  XHR.onload = () => {\n    // Process our return data\n    if (XHR.status >= 200 && XHR.status < 300) {\n      init(XHR.responseText);\n    } else {\n      //console.log(\"The request failed!\");\n    }\n    //console.log(\"This always runs...\");\n  };\n\n  let init = res => {\n    showForm();\n    addEventsToInputs();\n  };\n})(document);\n"],"file":"introducir-nombres-keyPress.js"}